!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ImgLazyLoad=e()}(this,function(){"use strict";function o(t,e){return t.getAttribute(e)}function h(t,e,i,n){if(!t.imgLoad){var o=r(t);e(t),function(e,t,i,n){var o=new Image;o.src=t,o.onload=function(){i(e)},o.onerror=function(t){n(e,t)}}(t,o.value,i,n)}}function r(t){var e={},i=o(t,"data-src"),n=o(t,"data-background-src");return i?e={key:"data-src",value:i}:n&&(e={key:"data-background-src",value:n}),e}function t(t){this.imgElementMap={},this.id=0,this.scrollHandle=null,this._mergeOptions(t),this.initDom(),this.initEvent(),this.initCallback()}return t.prototype={_mergeOptions:function(t){Object.assign(this,{target:null,el:null,distance:50,interval:250,beforeLoad:function(){},finishLoad:function(){},errorLoad:function(){}},t)},initDom:function(){this.lazyLoadWrap=this.el?document.querySelector(this.el):document,this.scrollWrap=this.target===window?this.target:this.lazyLoadWrap,this._getImgElementMap()},_getImgElementMap:function(){this.lazyloadList=this.lazyLoadWrap.querySelectorAll("[data-src], [data-background-src]"),this.imgElementMap={};for(var t=0,e=this.lazyloadList.length;t<e;t++){this.id++;var i=this.lazyloadList[t];i.id=this.id,this.imgElementMap[this.id]=i}},initEvent:function(){this.scrollHandle=function(i,n){var o=null;return function(){var t=this,e=arguments;o&&(clearTimeout(o),o=null),o=setTimeout(function(){i.apply(t,e)},n)}}(this.renderImg.bind(this),this.interval),this.scrollHandle(),function(t,e,i,n){t.addEventListener(e,i,n)}(this.scrollWrap,"scroll",this.scrollHandle,!1)},initCallback:function(){var i=this;this.imgLazyloadBefore=function(t){t.imgLoad=!0,i.beforeLoad(t)},this.imgLazyloadSuccess=function(t){var e=r(t);if("data-src"===e.key)t.src=e.value;else{if("data-background-src"!==e.key)return;t.style.backgroundImage="url(".concat(e.value,")")}!function(t,e){t.removeAttribute(e)}(t,e.key),delete i.imgElementMap[t.id],i.finishLoad(t,e.value)},this.imgLazyLoadError=function(t,e){t.imgLoad=!1,i.errorLoad(t,e)}},renderImg:function(){var t,e,i=function(t){var e={};if(t===window){var i=document.body.scrollTop||document.documentElement.scrollTop,n=document.body.scrollLeft||document.documentElement.scrollLeft,o=window,r=o.innerHeight;e={scrollTop:i,scrollLeft:n,offsetTop:0,offsetLeft:0,clientWidth:o.innerWidth,clientHeight:r}}else e=t;return e}(this.scrollWrap),n=i.scrollTop,o=i.scrollLeft,r=i.offsetTop,a=i.offsetLeft,l=i.clientWidth,s=i.clientHeight,c={top:n+r+this.distance+s,left:o+a+this.distance+l};for(var d in this.imgElementMap){var f=this.imgElementMap[d],u={top:f.offsetTop,left:f.offsetLeft};(t=c).top>=(e=u).top&&t.left>=e.left&&h(f,this.imgLazyloadBefore,this.imgLazyloadSuccess,this.imgLazyLoadError)}},refresh:function(){this._getImgElementMap()},distroryed:function(){!function(t,e,i){t.removeEventListener(t,e,i)}(this.scrollWrap,"scroll",this.scrollHandle)}},t});
